<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Hyperfit — Presentació Interactiva</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('images/backgrounds/campus.jpg') center/cover no-repeat;
      height: 100vh;
      font-family: 'Segoe UI', sans-serif;
      color: #222;
    }
    .overlay {
      background: rgba(255,255,255,0.85);
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
    }
    .presentation-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      width: 100vw;
      position: absolute;
      top: 0; left: 0;
      background: url('images/backgrounds/peses.jpg') center/cover no-repeat, rgba(255,255,255,0.92);
      z-index: 2;
    }
    .presentation-title {
      font-size: 2.5em;
      font-weight: bold;
      color: #c569f3;
      margin-bottom: 0.5em;
      margin-top: 0.5em;
      text-align: center;
    }
    .presentation-team {
      font-size: 1.5em;
      margin-bottom: 1.5em;
      color: #222;
      text-align: center;
    }
    .avatars-row {
      display: flex;
      gap: 36px;
      margin-bottom: 2em;
      justify-content: center;
    }
    .avatar-block {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .avatar-pres {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #c569f3;
      background: #f5e6fc;
      margin-bottom: 0.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5em;
      color: #c569f3;
    }
    .avatar-name {
      font-size: 1em;
      color: #c569f3;
      font-weight: bold;
      text-align: center;
    }
    .start-btn {
      background: #c569f3;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 14px 36px;
      font-size: 1.2em;
      cursor: pointer;
      margin-top: 1em;
      transition: background 0.2s;
    }
    .start-btn:hover {
      background: #a13dc9;
    }
    .character-box {
      background: #fff;
      border-radius: 16px 16px 0 0;
      box-shadow: 0 0 16px #bbb;
      width: 100%;
      max-width: 600px;
      margin-bottom: 0;
      padding: 32px 32px 24px 32px;
      text-align: left;
      position: relative;
      display: flex;
      align-items: flex-end;
      gap: 24px;
    }
    .avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #c569f3;
      background: #f5e6fc;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3em;
      color: #c569f3;
    }
    .dialogue-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .character-name {
      font-weight: bold;
      color: #c569f3;
      margin-bottom: 8px;
      font-size: 1.2em;
    }
    .dialogue {
      font-size: 1.1em;
      margin-bottom: 12px;
    }
    .next-btn {
      background: #c569f3;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 24px;
      font-size: 1em;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s;
      align-self: flex-end;
    }
    .next-btn:hover {
      background: #a13dc9;
    }
    .carousel-container {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 0;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 10;
      background: rgba(255,255,255,0.96);
    }
    .carousel-title {
      font-size: 2.2em;
      color: #c569f3;
      margin-bottom: 32px;
      font-weight: bold;
    }
    .carousel {
      display: flex;
      align-items: center;
      gap: 48px;
    }
    .carousel-button {
      background: #c569f3;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 2.2em;
      cursor: pointer;
      box-shadow: 0 2px 8px #bbb;
      transition: background 0.2s;
    }
    .carousel-button:hover {
      background: #a13dc9;
    }
    .carousel-event {
      min-width: 350px;
      min-height: 180px;
      background: #f5e6fc;
      border-radius: 18px;
      box-shadow: 0 0 16px #bbb;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 48px 56px;
      font-size: 2em;
      color: #222;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      position: relative;
      text-align: center;
    }
    .carousel-event.selected,
    .carousel-event:active {
      transform: scale(1.04);
      box-shadow: 0 0 24px #c569f388;
      border: 3px solid #c569f3;
    }
    .carousel-event img {
      width: auto;
      height: 120px;
      max-width: 220px;
      margin-bottom: 16px;
      display: block;
      object-fit: contain;
    }
    .carousel-event-desc {
      font-size: 0.7em;
      color: #666;
      margin-top: 12px;
    }
    .sprint-page {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 20;
      background: rgba(255,255,255,0.98);
    }
    /* New styles for buttons to carousel */
    .btn-to-carousel {
      position: absolute;
      top: 24px;
      right: 32px;
      z-index: 100;
      background: #fff;
      color: #c569f3;
      border: 2px solid #c569f3;
      border-radius: 8px;
      padding: 8px 18px;
      font-size: 1em;
      font-family: 'Segoe UI', cursive;
      cursor: pointer;
      box-shadow: 0 2px 8px #bbb;
    }

    /* Update the style for the two buttons: "Etapes del projecte" and "Veure Criteris d'Acceptació (PDF)" */
    .btn-to-carousel,
    #btn-criteris-acceptacio {
      font-family: inherit !important; /* Use the same font as the dialogs */
      font-size: 1.1em;
      letter-spacing: 0.01em;
      font-weight: normal;
    }

    /* New styles for the presentation screen content */
    .presentation-content {
      background: rgba(255,255,255,0.93);
      border-radius: 32px;
      box-shadow: 0 4px 32px #bbb;
      padding: 32px 64px 24px 64px;
      margin-bottom: 2em;
      max-width: 1100px;
      width: 90vw;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="overlay">
    <!-- Presentation Screen -->
    <div class="presentation-screen" id="presentation-screen">
      <!-- New content wrapper -->
      <div class="presentation-content">
        <div class="presentation-title">Hyperfit</div>
        <div style="font-size: 1.1em; color: #444; text-align: center; max-width: 700px; margin-bottom: 1.2em;">
          Descobreix la teva rutina d'exercicis amb IA!<br>
          Explora el nostre projecte, l'equip i totes les etapes del desenvolupament.<br>
          Fes clic a <b>Començar</b> per iniciar!
        </div>
        <div class="presentation-team" style="margin-bottom: 1.5em;">Equip: ENBIDIA</div>
        <div class="avatars-row" style="margin-top: 0;">
          <!-- Team members group -->
          <div style="display: flex; gap: 36px; margin-right: 60px;">
            <div class="avatar-block">
              <img src="images/characters/avatar_cinta.png" alt="Cinta" class="avatar-pres">
              <div class="avatar-name">Cinta</div>
            </div>
            <div class="avatar-block">
              <img src="images/characters/avatar_davi.jpeg" alt="Davi" class="avatar-pres">
              <div class="avatar-name">Davi</div>
            </div>
            <div class="avatar-block">
              <img src="images/characters/avatar_ivan.jpeg" alt="Ivan" class="avatar-pres">
              <div class="avatar-name">Ivan</div>
            </div>
            <div class="avatar-block">
              <img src="images/characters/avatar_yeray.jpeg" alt="Yeray" class="avatar-pres">
              <div class="avatar-name">Yeray</div>
            </div>
            <div class="avatar-block">
              <img src="images/characters/avatar_ferran.jpeg" alt="Ferran" class="avatar-pres">
              <div class="avatar-name">Ferran</div>
            </div>
            <div class="avatar-block">
              <img src="images/characters/avatar_men.jpeg" alt="Men" class="avatar-pres">
              <div class="avatar-name">Men</div>
            </div>
          </div>
          <!-- Teacher separated -->
          <div class="avatar-block" style="margin-left: 60px;">
            <img src="images/characters/avatar_toni.png" alt="Toni" class="avatar-pres">
            <div class="avatar-name">Toni</div>
          </div>
        </div>
      </div>
      <button class="start-btn" id="start-btn">Començar</button>
    </div>
    <!-- Dialogue Scene -->
    <div class="character-box" id="scene-box" style="display:none;">
      <img src="images/characters/avatar_cinta.png" alt="Cinta" class="avatar" id="avatar-img">
      <div class="dialogue-content">
        <div class="character-name" id="character-name">Cinta</div>
        <div class="dialogue" id="dialogue-text">
          Hola Toni! Soc la Cinta, portaveu de l’equip ENBIDIA.<br><br>
          Avui us presentarem Hyperfit, el nostre projecte per a l’assignatura d’Enginyeria de Software!
        </div>
        <button class="next-btn" id="next-btn">Següent</button>
      </div>
    </div>
    <!-- Carousel Container -->
    <div class="carousel-container" id="carousel-container">
      <div class="carousel-title">Etapes del projecte</div>
      <div class="carousel">
        <button id="carousel-prev" class="carousel-button">&#8592;</button>
        <div id="carousel-event" class="carousel-event" tabindex="0"></div>
        <button id="carousel-next" class="carousel-button">&#8594;</button>
      </div>
    </div>
    <!-- Sprint 0 Page -->
    <div class="sprint-page" id="sprint0-page" style="display:none;">
      <div class="sprint0-overlay" style="position:fixed; inset:0; background: url('images/backgrounds/lego.jpg') center/cover no-repeat; z-index:-1;"></div>
      <div class="character-box" style="margin:auto; position: absolute; left: 0; right: 0; bottom: 0; max-width: 600px;">
        <img src="images/characters/avatar_ivan.jpeg" alt="Ivan" class="avatar" id="sprint0-avatar">
        <div class="dialogue-content">
          <div class="character-name" id="sprint0-character-name">Ivan</div>
          <div class="dialogue" id="sprint0-dialogue-text"></div>
          <button class="next-btn" id="sprint0-next-btn">Següent</button>
          <button class="next-btn" id="sprint0-close" style="display:none; margin-left:8px;">Tornar</button>
        </div>
      </div>
      <!-- Add button to return to carousel -->
      <button class="btn-to-carousel" onclick="goToCarousel()">
        ⬅ Etapes del projecte
      </button>
    </div>
    <!-- Sprint 1 Page -->
    <div class="sprint-page" id="sprint1-page" style="display:none;">
      <div class="sprint1-overlay" style="position:fixed; inset:0; background: url('images/backgrounds/post-its.jpg') center/cover no-repeat; z-index:-1;"></div>
      <div class="character-box" style="margin:auto; position: absolute; left: 0; right: 0; bottom: 0; max-width: 600px;">
        <img src="images/characters/avatar_men.jpeg" alt="Men" class="avatar" id="sprint1-avatar">
        <div class="dialogue-content">
          <div class="character-name" id="sprint1-character-name">Men</div>
          <div class="dialogue" id="sprint1-dialogue-text"></div>
          <button class="next-btn" id="sprint1-next-btn">Següent</button>
          <button class="next-btn" id="sprint1-close" style="display:none; margin-left:8px;">Tornar</button>
        </div>
      </div>
      <!-- Central buttons for documents -->
      <div style="position:absolute; top:20%; left:0; right:0; display:flex; flex-direction:row; align-items:center; justify-content:center; z-index:2; gap:32px;">
        <button id="btn-product-canvas"
          style="background:#ffb300; color:#000000; border:none; border-radius:12px; padding:18px 38px; font-size:1.2em; cursor:pointer; box-shadow:0 2px 8px #bbb; position:relative; left:-120px;">
          Veure Product Canvas
        </button>
        <button id="btn-especificacio"
          style="background:#daf414; color:#000000; border:none; border-radius:12px; padding:18px 38px; font-size:1.2em; cursor:pointer; box-shadow:0 2px 8px #bbb; text-align: center; right:60px; margin-top:190px">
          Veure Especificació<br/>de Requisits
        </button>
      </div>
      <!-- Add button to return to carousel -->
      <button class="btn-to-carousel" onclick="goToCarousel()">
        ⬅ Etapes del projecte
      </button>
    </div>
    <!-- Sprint 2 Page -->
    <div class="sprint-page" id="sprint2-page" style="display:none;">
      <div class="sprint2-overlay" style="position:fixed; inset:0; background: url('images/backgrounds/creacio-MVP.jpg') center/cover no-repeat; z-index:-1;"></div>
      <div class="character-box" style="margin:auto; position: absolute; left: 0; right: 0; bottom: 0; max-width: 600px;">
        <img src="images/characters/avatar_yeray.jpeg" alt="Yeray" class="avatar" id="sprint2-avatar">
        <div class="dialogue-content">
          <div class="character-name" id="sprint2-character-name">Yeray</div>
          <div class="dialogue" id="sprint2-dialogue-text"></div>
          <button class="next-btn" id="sprint2-next-btn">Següent</button>
          <button class="next-btn" id="sprint2-close" style="display:none; margin-left:8px;">Tornar</button>
        </div>
      </div>
      <!-- Timeline and tooltip (inside #sprint2-page, after the character-box) -->
      <div style="position:absolute; top:18%; left:0; right:0; display:flex; flex-direction:column; align-items:center; z-index:2;">
        <!-- Vertical timeline line -->
        <div style="height: 340px; width: 6px; background: #222; border-radius: 3px; position: relative; margin-bottom: 0; margin-top: 0; box-shadow: 0 2px 8px #bbb;">
          <!-- Timeline points (buttons) -->
          <button class="timeline-point" data-title="User Story Mapping"
            style="position:absolute; top:0; left:50%; transform:translate(-50%,-50%); background:#fffbe6; border:4px solid #ffb300; width:54px; height:54px; border-radius:50%; box-shadow:0 2px 8px #ffb30044; cursor:pointer; display:flex; align-items:center; justify-content:center; font-family:'Segoe UI'; font-size:1.1em; transition:box-shadow 0.2s;">
            <span style="font-size:1.5em; color:#ffb300;">🗺️</span>
          </button>
          <button class="timeline-point" data-title="Journey Map Usuari"
            style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:#f5e6fc; border:4px solid #c569f3; width:54px; height:54px; border-radius:50%; box-shadow:0 2px 8px #c569f344; cursor:pointer; display:flex; align-items:center; justify-content:center; font-family:'Segoe UI'; font-size:1.1em; transition:box-shadow 0.2s;">
            <span style="font-size:1.5em; color:#c569f3;">🟣</span>
          </button>
          <button class="timeline-point" data-title="Journey Map Entrenador/a"
            style="position:absolute; top:100%; left:50%; transform:translate(-50%,-50%); background:#e0f3ff; border:4px solid #2a7cff; width:54px; height:54px; border-radius:50%; box-shadow:0 2px 8px #2a7cff44; cursor:pointer; display:flex; align-items:center; justify-content:center; font-family:'Segoe UI'; font-size:1.1em; transition:box-shadow 0.2s;">
            <span style="font-size:1.5em; color:#2a7cff;">🔵</span>
          </button>
        </div>
        <!-- Tooltip for timeline points -->
        <div id="timeline-tooltip" style="display:none; position:fixed; background:#fff; color:#222; border-radius:8px; padding:8px 18px; font-family:'Segoe UI'; font-size:1.1em; box-shadow:0 2px 8px #bbb; pointer-events:none; z-index:100;"></div>
      </div>

      <script>
        // Vertical timeline points logic for Sprint 2 (tooltip follows mouse)
        (function() {
          const timelinePoints = document.querySelectorAll('.sprint-page#sprint2-page .timeline-point');
          const timelineTooltip = document.getElementById('timeline-tooltip');
          const timelineLinks = [
            'images/projects/user-story-mapping.jpg',
            'images/projects/journey-map1.jpg',
            'images/projects/journey-map2.jpg'
          ];
          const timelineFiles = [
            'User Story Mapping',
            'Journey Map Usuari',
            'Journey Map Entrenador/a'
          ];

          timelinePoints.forEach((point, idx) => {
            point.addEventListener('mouseenter', function(e) {
              timelineTooltip.textContent = timelineFiles[idx];
              timelineTooltip.style.display = 'block';
            });
            point.addEventListener('mousemove', function(e) {
              timelineTooltip.style.left = (e.clientX + 18) + 'px';
              timelineTooltip.style.top = (e.clientY - 10) + 'px';
            });
            point.addEventListener('mouseleave', function() {
              timelineTooltip.style.display = 'none';
            });
            point.addEventListener('click', function() {
              window.open(timelineLinks[idx], '_blank');
            });
          });
        })();
      </script>
    </div> 
      
    <!-- Reunió Page -->
    <div class="sprint-page" id="reunio-page" style="display:none;">
      <div class="reunio-overlay" style="position:fixed; inset:0; background: url('images/backgrounds/reunio.jpg') center/cover no-repeat; z-index:-1;"></div>
      
      <!-- Bloc de Toni -->
      <div id="reunio-toni-box" class="character-box" style="position: absolute; top: 40px; left: 0; right: 0; margin: auto; max-width: 600px; display: none;">
        <img src="images/characters/avatar_toni.png" alt="Toni" class="avatar" id="reunio-toni-avatar">
        <div class="dialogue-content">
          <div class="character-name" id="reunio-toni-character-name">Toni</div>
          <div class="dialogue" id="reunio-toni-dialogue-text"></div>
          <button class="next-btn" id="reunio-toni-next-btn" style="display:none;">Següent</button>
        </div>
      </div>

      <!-- Bloc de Ferran -->
      <div class="character-box" id="reunio-ferran-box" style="margin:auto; position: absolute; left: 0; right: 0; bottom: 0; max-width: 600px;">
        <img src="images/characters/avatar_ferran.jpeg" alt="Ferran" class="avatar" id="reunio-avatar">
        <div class="dialogue-content">
          <div class="character-name" id="reunio-character-name">Ferran</div>
          <div class="dialogue" id="reunio-dialogue-text"></div>
          <button class="next-btn" id="reunio-next-btn">Següent</button>
          <button class="next-btn" id="reunio-close" style="display:none; margin-left:8px;">Tornar</button>
        </div>
      </div>
      <button class="btn-to-carousel" onclick="goToCarousel()">
        ⬅ Etapes del projecte
      </button>
    </div>

    <!-- Sprint 3 Page -->
    <div class="sprint-page" id="sprint3-page" style="display:none;">
      <div class="sprint3-overlay" style="position:fixed; inset:0; background: url('images/backgrounds/implementacio.jpg') center/cover no-repeat; z-index:-1;"></div>
      <!-- Image and button side by side, button centered and separated -->
      <div id="sprint3-image-container"
           style="position:absolute; top:80px; left:40px; z-index:2; display:flex; align-items:center; gap:64px;">
        <img
          id="sprint3-image"
          src="images/projects/figma.jpg"
          alt="Sprint 3 Figma"
          style="max-width:240px; border-radius:16px; box-shadow:0 2px 12px #bbb; cursor:pointer; transition: box-shadow 0.2s;"
          onclick="window.open('https://www.figma.com/proto/ibH8mfDIIyRyINgMWlI64H/ENBIDIA-figma?node-id=4-145&starting-point-node-id=4%3A145', '_blank');"
        >
        <div style="display:flex; flex-direction:column; justify-content:center; height:100%; margin-left: 120px;">
          <button id="btn-criteris-acceptacio"
            style="background: #c569f3; color:#ffffff; border:none; border-radius:12px; padding:16px 32px; font-size:1.1em; font-family:'Segoe UI'; box-shadow:0 2px 8px #bbb; cursor:pointer;">
            Veure Criteris d'Acceptació
          </button>
        </div>
      </div>
      <div class="character-box" style="margin:auto; position: absolute; left: 0; right: 0; bottom: 0; max-width: 600px;">
        <img src="images/characters/avatar_davi.jpeg" alt="Davi" class="avatar" id="sprint3-avatar">
        <div class="dialogue-content">
          <div class="character-name" id="sprint3-character-name">Davi</div>
          <div class="dialogue" id="sprint3-dialogue-text"></div>
          <button class="next-btn" id="sprint3-next-btn">Següent</button>
          <button class="next-btn" id="sprint3-close" style="display:none; margin-left:8px;">Tornar</button>
        </div>
      </div>
      <!-- Add button to return to carousel -->
      <button class="btn-to-carousel" onclick="goToCarousel()">
        ⬅ Etapes del projecte
      </button>
    </div>


  <audio id="type-sound" src="audios/typewriter-key.wav" preload="auto"></audio>


    <!-- Sprint 4 Page -->
    <div class="sprint-page" id="sprint4-page" style="display:none;">
      <div class="sprint4-overlay" style="position:fixed; inset:0; background: url('images/backgrounds/gym_app.jpg') center/cover no-repeat; z-index:-1;"></div>
      <div class="character-box" style="margin:auto; position: absolute; left: 0; right: 0; bottom: 0; max-width: 600px;">
        <img src="images/characters/avatar_cinta.png" alt="Cinta" class="avatar" id="sprint4-avatar">
        <div class="dialogue-content">
          <div class="character-name" id="sprint4-character-name">Cinta</div>
          <div class="dialogue" id="sprint4-dialogue-text"></div>
          <button class="next-btn" id="sprint4-next-btn">Següent</button>
          <button class="next-btn" id="sprint4-close" style="display:none; margin-left:8px;">Tornar</button>
        </div>
      </div>
      <!-- Add button to return to carousel -->
      <div style="width:100%; display:flex; justify-content:center; margin-top:24px;">
        <button id="btn-trello"
          style="background: #c569f3; color:#fff; border:none; border-radius:12px; padding:16px 32px; font-size:1.1em; font-family:'Segoe UI'; font-weight:normal; letter-spacing:0.01em; box-shadow:0 2px 8px #bbb; cursor:pointer;">
          Veure Trello
        </button>
      </div>
      <button class="btn-to-carousel" onclick="goToCarousel()">
        ⬅ Etapes del projecte
      </button>
    </div>

    <!-- Demo Page -->
    <div class="sprint-page" id="demo-page" style="display:none;">
      <div class="demo-overlay" style="position:fixed; inset:0; background: url('images/backgrounds/go-gym.jpg') center/cover no-repeat; z-index:-1;"></div>
      <div class="character-box" style="margin:auto; position: absolute; left: 0; right: 0; bottom: 0; max-width: 600px;">
        <img src="images/characters/avatar_davi.jpeg" alt="Davi" class="avatar" id="demo-avatar">
        <div class="dialogue-content">
          <div class="character-name" id="demo-character-name">Davi</div>
          <div class="dialogue" id="demo-dialogue-text"></div>
          <button class="next-btn" id="demo-next-btn">Següent</button>
          <button class="next-btn" id="demo-close" style="display:none; margin-left:8px;">Tornar</button>
        </div>
      </div>
      <!-- Add button to return to carousel -->
      <button class="btn-to-carousel" onclick="goToCarousel()">
        ⬅ Etapes del projecte
      </button>
    </div>


  <script>
  // Dialogues for Cinta
  const dialogues = [
    {
      name: "Cinta",
      text: "Hola Toni! Soc la Cinta i formo part de l’equip ENBIDIA."
    },
    {
      name: "Cinta",
      text: "Hyperfit és una aplicació que hem creat per ajudar a generar rutines de gimnàs personalitzades amb intel·ligència artificial."
    },
    {
      name: "Cinta",
      text: "Si vols saber com hem arribat fins aquí, acompanya’ns en aquest viatge a través de cada sprint!"
    }
  ];
  let idx = 0;
  const nameBox = document.getElementById('character-name');
  const dialogueBox = document.getElementById('dialogue-text');
  const nextBtn = document.getElementById('next-btn');
  const avatarImg = document.getElementById('avatar-img');
  const presentationScreen = document.getElementById('presentation-screen');
  const sceneBox = document.getElementById('scene-box');
  const startBtn = document.getElementById('start-btn');
  const typeSound = document.getElementById('type-sound');

  let typing = false;
  let typingTimeout;

  function playTypeSound() {
    // Rewind and play for each letter
    typeSound.currentTime = 0;
    typeSound.play();
  }

  function typeDialogue(text, callback) {
    typing = true;
    dialogueBox.innerHTML = "";
    let i = 0;
    function typeChar() {
      if (i < text.length) {
        dialogueBox.innerHTML += text[i] === "\n" ? "<br>" : text[i];
        // Only play sound for visible characters (not spaces or line breaks)
        if (text[i] !== " " && text[i] !== "\n") playTypeSound();
        i++;
        typingTimeout = setTimeout(typeChar, 22); // speed in ms
      } else {
        typing = false;
        if (callback) callback();
      }
    }
    typeChar();
  }

  function showDialogue(index) {
    nameBox.textContent = dialogues[index].name;
    typeDialogue(dialogues[index].text);
  }

  startBtn.addEventListener('click', () => {
    presentationScreen.style.display = 'none';
    sceneBox.style.display = 'flex';
    idx = 0;
    showDialogue(idx);
    nextBtn.style.display = "inline-block";
  });

  nextBtn.addEventListener('click', () => {
    if (typing) {
      clearTimeout(typingTimeout);
      dialogueBox.innerHTML = dialogues[idx].text.replace(/\n/g, "<br>");
      typing = false;
      return;
    }
    idx++;
    if (idx < dialogues.length) {
      showDialogue(idx);
    } else {
      // Play the typewriter sound for the final message as it appears letter by letter
      typeDialogue("Comencem el viatge pels nostres sprints!", showCarousel);
      nextBtn.style.display = "none";
    }
  });

  // Carousel data
  const events = [
    { 
      title: "Sprint 0", 
      desc: "Coneixement inicial i taller de LEGO",
      img: "images/backgrounds/lego.jpg",
    },
    { title: "Sprint 1", 
      desc: "Concepció i disseny del projecte",
      img: "images/backgrounds/post-its.jpg",
    },

    { title: "Sprint 2",
      desc: "MVP i feedback dels usuaris",
      img:  "images/backgrounds/creacio-MVP.jpg"
    },

    { title: "Sprint 3", 
      desc: "Implementació i criteris d’acceptació",
      img : "images/backgrounds/implementacio.jpg"
    },

    { title: "Reunió", 
      desc: "Resolució de problemes d’organització", 
      img: "images/backgrounds/reunio.jpg"
    },

    { title: "Sprint 4", 
      desc: "Entrega final i Trello",
      img: "images/backgrounds/gym_app.jpg"
    },

    { title: "Demo", 
      desc: "Presentació final del projecte",
      img: "images/backgrounds/go-gym.jpg"
    }
  ];
  let eventIdx = 0;
  const carouselContainer = document.getElementById('carousel-container');
  const carouselEvent = document.getElementById('carousel-event');
  const carouselPrev = document.getElementById('carousel-prev');
  const carouselNext = document.getElementById('carousel-next');

  function updateCarousel() {
    const event = events[eventIdx];
    let html = '';
    if (event.img) {
      html += `<img src="${event.img}" alt="${event.title}">`;
    }
    html += `<div>${event.title}</div>`;
    html += `<div class="carousel-event-desc">${event.desc}</div>`;
    carouselEvent.innerHTML = html;
    // Highlight selected
    carouselEvent.classList.add('selected');
    setTimeout(() => carouselEvent.classList.remove('selected'), 200);
  }

  if (carouselPrev && carouselNext) {
    carouselPrev.addEventListener('click', () => {
      eventIdx = (eventIdx - 1 + events.length) % events.length;
      updateCarousel();
    });
    carouselNext.addEventListener('click', () => {
      eventIdx = (eventIdx + 1) % events.length;
      updateCarousel();
    });
  }

  // Allow clicking on event to select/show more (for now just highlight)
  carouselEvent.addEventListener('click', () => {
    if (events[eventIdx].title === "Sprint 0") {
      document.getElementById('sprint0-page').style.display = "flex";
      document.getElementById('carousel-container').style.display = "none";
    } else {
      carouselEvent.classList.add('selected');
      setTimeout(() => carouselEvent.classList.remove('selected'), 300);
    }
  });

  // Close Sprint 0 page and return to carousel
  document.getElementById('sprint0-close').addEventListener('click', () => {
    document.getElementById('sprint0-page').style.display = "none";
    document.getElementById('carousel-container').style.display = "flex";
    carouselEvent.focus();
  });

  // Sprint 1 buttons open files
  document.getElementById('btn-product-canvas').onclick = function() {
    window.open('images/projects/product_canvas.jpg', '_blank');
  };
  document.getElementById('btn-especificacio').onclick = function() {
    window.open('documents/Especificació de requisits - Hyperfit.pdf', '_blank');
  };

  // Also allow keyboard navigation
  carouselEvent.addEventListener('keydown', (e) => {
    if (e.key === "ArrowLeft") {
      carouselPrev.click();
    } else if (e.key === "ArrowRight") {
      carouselNext.click();
    } else if (e.key === "Enter" || e.key === " ") {
      carouselEvent.click();
    }
  });

  // Show carousel after last dialogue
  function showCarousel() {
    carouselContainer.style.display = "flex";
    updateCarousel();
    carouselEvent.focus();
  }

  // Sprint 0 dialogue data
  const sprint0Dialogues = [
    {
      name: "Ivan",
      text: "Vam començar amb un taller de LEGO. Això ens va ajudar a conèixer-nos millor."
    },
    {
      name: "Ivan",
      text: "Aquest 'gimnàs' ens va inspirar a enfocar el nostre producte. Una aplicació per al gimnàs."
    }
  ];
  let sprint0Idx = 0;
  const sprint0Page = document.getElementById('sprint0-page');
  const sprint0DialogueBox = document.getElementById('sprint0-dialogue-text');
  const sprint0NameBox = document.getElementById('sprint0-character-name');
  const sprint0NextBtn = document.getElementById('sprint0-next-btn');
  const sprint0CloseBtn = document.getElementById('sprint0-close');
  const sprint0Avatar = document.getElementById('sprint0-avatar');

  let sprint0Typing = false;
  let sprint0TypingTimeout;

  function typeSprint0Dialogue(text, callback) {
    sprint0Typing = true;
    sprint0DialogueBox.innerHTML = "";
    let i = 0;
    function typeChar() {
      if (i < text.length) {
        sprint0DialogueBox.innerHTML += text[i] === "\n" ? "<br>" : text[i];
        if (text[i] !== " " && text[i] !== "\n") playTypeSound();
        i++;
        sprint0TypingTimeout = setTimeout(typeChar, 22);
      } else {
        sprint0Typing = false;
        if (callback) callback();
      }
    }
    typeChar();
  }

  function showSprint0Dialogue(index) {
    sprint0NameBox.textContent = sprint0Dialogues[index].name;
    typeSprint0Dialogue(sprint0Dialogues[index].text);
    sprint0NextBtn.style.display = (index < sprint0Dialogues.length - 1) ? "inline-block" : "none";
    sprint0CloseBtn.style.display = (index === sprint0Dialogues.length - 1) ? "inline-block" : "none";
  }

  // Show Sprint 0 page when Sprint 0 event is clicked in the carousel
  carouselEvent.addEventListener('click', () => {
    if (events[eventIdx].title === "Sprint 0") {
      sprint0Page.style.display = "flex";
      sprint0Page.style.flexDirection = "column";
      sprint0Page.style.alignItems = "center";
      sprint0Page.style.justifyContent = "center";
      document.getElementById('carousel-container').style.display = "none";
      sprint0Idx = 0;
      showSprint0Dialogue(sprint0Idx);
    } else {
      carouselEvent.classList.add('selected');
      setTimeout(() => carouselEvent.classList.remove('selected'), 300);
    }
  });

  sprint0NextBtn.addEventListener('click', () => {
    if (sprint0Typing) {
      clearTimeout(sprint0TypingTimeout);
      sprint0DialogueBox.innerHTML = sprint0Dialogues[sprint0Idx].text.replace(/\n/g, "<br>");
      sprint0Typing = false;
      return;
    }
    sprint0Idx++;
    if (sprint0Idx < sprint0Dialogues.length) {
      showSprint0Dialogue(sprint0Idx);
    }
  });
    // Sprint 1 dialogue data
  const sprint1Dialogues = [
    {
      name: "Men",
      text: "Vam crear el Product Canvas i vam definir els requisits."
    },
    {
      name: "Men",
      text: "Això ens va ajudar a veure les funcionalitats clau i com encaixava amb les necessitats dels usuaris."
    }
  ];
  let sprint1Idx = 0;
  const sprint1Page = document.getElementById('sprint1-page');
  const sprint1DialogueBox = document.getElementById('sprint1-dialogue-text');
  const sprint1NameBox = document.getElementById('sprint1-character-name');
  const sprint1NextBtn = document.getElementById('sprint1-next-btn');
  const sprint1CloseBtn = document.getElementById('sprint1-close');
  const sprint1Avatar = document.getElementById('sprint1-avatar');

  let sprint1Typing = false;
  let sprint1TypingTimeout;

  function typeSprint1Dialogue(text, callback) {
    sprint1Typing = true;
    sprint1DialogueBox.innerHTML = "";
    let i = 0;
    function typeChar() {
      if (i < text.length) {
        sprint1DialogueBox.innerHTML += text[i] === "\n" ? "<br>" : text[i];
        if (text[i] !== " " && text[i] !== "\n") playTypeSound();
        i++;
        sprint1TypingTimeout = setTimeout(typeChar, 22);
      } else {
        sprint1Typing = false;
        if (callback) callback();
      }
    }
    typeChar();
  }

  function showSprint1Dialogue(index) {
    sprint1NameBox.textContent = sprint1Dialogues[index].name;
    typeSprint1Dialogue(sprint1Dialogues[index].text);
    sprint1NextBtn.style.display = (index < sprint1Dialogues.length - 1) ? "inline-block" : "none";
    sprint1CloseBtn.style.display = (index === sprint1Dialogues.length - 1) ? "inline-block" : "none";
  }

  carouselEvent.addEventListener('click', () => {
    if (events[eventIdx].title === "Sprint 1") {
      sprint1Page.style.display = "flex";
      sprint1Page.style.flexDirection = "column";
      sprint1Page.style.alignItems = "center";
      sprint1Page.style.justifyContent = "center";
      document.getElementById('carousel-container').style.display = "none";
      sprint1Idx = 0;
      showSprint1Dialogue(sprint1Idx);
    }
  });

  sprint1NextBtn.addEventListener('click', () => {
    if (sprint1Typing) {
      clearTimeout(sprint1TypingTimeout);
      sprint1DialogueBox.innerHTML = sprint1Dialogues[sprint1Idx].text.replace(/\n/g, "<br>");
      sprint1Typing = false;
      return;
    }
    sprint1Idx++;
    if (sprint1Idx < sprint1Dialogues.length) {
      showSprint1Dialogue(sprint1Idx);
    }
  });

  sprint1CloseBtn.addEventListener('click', () => {
    sprint1Page.style.display = "none";
    document.getElementById('carousel-container').style.display = "flex";
    carouselEvent.focus();
  });


  // Sprint 2 dialogue data
  const sprint2Dialogues = [
    {
      name: "Yeray",
      text: "Vam construir el nostre MVP i definir dues situacions d’ús reals."
    },
    {
      name: "Yeray",
      text: "Amb el User Story Mapping i els Journey Maps vam entendre millor el recorregut de l’usuari dins l'app."
    }
  ];
  let sprint2Idx = 0;
  const sprint2Page = document.getElementById('sprint2-page');
  const sprint2DialogueBox = document.getElementById('sprint2-dialogue-text');
  const sprint2NameBox = document.getElementById('sprint2-character-name');
  const sprint2NextBtn = document.getElementById('sprint2-next-btn');
  const sprint2CloseBtn = document.getElementById('sprint2-close');
  const sprint2Avatar = document.getElementById('sprint2-avatar');

  let sprint2Typing = false;
  let sprint2TypingTimeout;

  function typeSprint2Dialogue(text, callback) {
    sprint2Typing = true;
    sprint2DialogueBox.innerHTML = "";
    let i = 0;
    function typeChar() {
      if (i < text.length) {
        sprint2DialogueBox.innerHTML += text[i] === "\n" ? "<br>" : text[i];
        if (text[i] !== " " && text[i] !== "\n") playTypeSound();
        i++;
        sprint2TypingTimeout = setTimeout(typeChar, 22);
      } else {
        sprint2Typing = false;
        if (callback) callback();
      }
    }
    typeChar();
  }

  function showSprint2Dialogue(index) {
    sprint2NameBox.textContent = sprint2Dialogues[index].name;
    typeSprint2Dialogue(sprint2Dialogues[index].text);
    sprint2NextBtn.style.display = (index < sprint2Dialogues.length - 1) ? "inline-block" : "none";
    sprint2CloseBtn.style.display = (index === sprint2Dialogues.length - 1) ? "inline-block" : "none";
  }

  carouselEvent.addEventListener('click', () => {
    if (events[eventIdx].title === "Sprint 2") {
      sprint2Page.style.display = "flex";
      sprint2Page.style.flexDirection = "column";
      sprint2Page.style.alignItems = "center";
      sprint2Page.style.justifyContent = "center";
      document.getElementById('carousel-container').style.display = "none";
      sprint2Idx = 0;
      showSprint2Dialogue(sprint2Idx);
    }
  });

  sprint2NextBtn.addEventListener('click', () => {
    if (sprint2Typing) {
      clearTimeout(sprint2TypingTimeout);
      sprint2DialogueBox.innerHTML = sprint2Dialogues[sprint2Idx].text.replace(/\n/g, "<br>");
      sprint2Typing = false;
      return;
    }
    sprint2Idx++;
    if (sprint2Idx < sprint2Dialogues.length) {
      showSprint2Dialogue(sprint2Idx);
    }
  });

  sprint2CloseBtn.addEventListener('click', () => {
    sprint2Page.style.display = "none";
    document.getElementById('carousel-container').style.display = "flex";
    carouselEvent.focus();
  });


  // Sprint 3 dialogue data
  const sprint3Dialogues = [
    {
      name: "Davi",
      text: "Vam crear els dissenys de l’aplicació amb Figma."
    },
    {
      name: "Davi",
      text: "També vam definir els criteris d’acceptació de cada història per poder validar funcionalitats."
    }
  ];
  let sprint3Idx = 0;
  const sprint3Page = document.getElementById('sprint3-page');
  const sprint3DialogueBox = document.getElementById('sprint3-dialogue-text');
  const sprint3NameBox = document.getElementById('sprint3-character-name');
  const sprint3NextBtn = document.getElementById('sprint3-next-btn');
  const sprint3CloseBtn = document.getElementById('sprint3-close');
  const sprint3Avatar = document.getElementById('sprint3-avatar');

  let sprint3Typing = false;
  let sprint3TypingTimeout;

  function typeSprint3Dialogue(text, callback) {
    sprint3Typing = true;
    sprint3DialogueBox.innerHTML = "";
    let i = 0;
    function typeChar() {
      if (i < text.length) {
        sprint3DialogueBox.innerHTML += text[i] === "\n" ? "<br>" : text[i];
        if (text[i] !== " " && text[i] !== "\n") playTypeSound();
        i++;
        sprint3TypingTimeout = setTimeout(typeChar, 22);
      } else {
        sprint3Typing = false;
        if (callback) callback();
      }
    }
    typeChar();
  }

  function showSprint3Dialogue(index) {
    sprint3NameBox.textContent = sprint3Dialogues[index].name;
    typeSprint3Dialogue(sprint3Dialogues[index].text);
    sprint3NextBtn.style.display = (index < sprint3Dialogues.length - 1) ? "inline-block" : "none";
    sprint3CloseBtn.style.display = (index === sprint3Dialogues.length - 1) ? "inline-block" : "none";
    // Always show the Figma image
    const imgContainer = document.getElementById('sprint3-image-container');
    imgContainer.style.display = "flex";
}

  carouselEvent.addEventListener('click', () => {
    if (events[eventIdx].title === "Sprint 3") {
      sprint3Page.style.display = "flex";
      sprint3Page.style.flexDirection = "column";
      sprint3Page.style.alignItems = "center";
      sprint3Page.style.justifyContent = "center";
      document.getElementById('carousel-container').style.display = "none";
      sprint3Idx = 0;
      showSprint3Dialogue(sprint3Idx);
    }
  });

  sprint3NextBtn.addEventListener('click', () => {
    if (sprint3Typing) {
      clearTimeout(sprint3TypingTimeout);
      sprint3DialogueBox.innerHTML = sprint3Dialogues[sprint3Idx].text.replace(/\n/g, "<br>");
      sprint3Typing = false;
      return;
    }
    sprint3Idx++;
    if (sprint3Idx < sprint3Dialogues.length) {
      showSprint3Dialogue(sprint3Idx);
    }
  });

  sprint3CloseBtn.addEventListener('click', () => {
    sprint3Page.style.display = "none";
    document.getElementById('carousel-container').style.display = "flex";
    carouselEvent.focus();
  });

  // Sprint 4 dialogue data
  const sprint4Dialogues = [
    {
      name: "Cinta",
      text: "Finalment vam preparar aquesta presentació interactiva!"
    },
    {
      name: "Cinta",
      text: "Aquí pots veure una captura de Trello amb totes les tasques i etiquetes."
    }
  ];
  let sprint4Idx = 0;
  const sprint4Page = document.getElementById('sprint4-page');
  const sprint4DialogueBox = document.getElementById('sprint4-dialogue-text');
  const sprint4NameBox = document.getElementById('sprint4-character-name');
  const sprint4NextBtn = document.getElementById('sprint4-next-btn');
  const sprint4CloseBtn = document.getElementById('sprint4-close');
  const sprint4Avatar = document.getElementById('sprint4-avatar');

  let sprint4Typing = false;
  let sprint4TypingTimeout;

  function typeSprint4Dialogue(text, callback) {
    sprint4Typing = true;
    sprint4DialogueBox.innerHTML = "";
    let i = 0;
    function typeChar() {
      if (i < text.length) {
        sprint4DialogueBox.innerHTML += text[i] === "\n" ? "<br>" : text[i];
        if (text[i] !== " " && text[i] !== "\n") playTypeSound();
        i++;
        sprint4TypingTimeout = setTimeout(typeChar, 22);
      } else {
        sprint4Typing = false;
        if (callback) callback();
      }
    }
    typeChar();
  }

  function showSprint4Dialogue(index) {
    sprint4NameBox.textContent = sprint4Dialogues[index].name;
    typeSprint4Dialogue(sprint4Dialogues[index].text);
    sprint4NextBtn.style.display = (index < sprint4Dialogues.length - 1) ? "inline-block" : "none";
    sprint4CloseBtn.style.display = (index === sprint4Dialogues.length - 1) ? "inline-block" : "none";
  }

  carouselEvent.addEventListener('click', () => {
    if (events[eventIdx].title === "Sprint 4") {
      sprint4Page.style.display = "flex";
      sprint4Page.style.flexDirection = "column";
      sprint4Page.style.alignItems = "center";
      sprint4Page.style.justifyContent = "center";
      document.getElementById('carousel-container').style.display = "none";
      sprint4Idx = 0;
      showSprint4Dialogue(sprint4Idx);
    }
  });

  sprint4NextBtn.addEventListener('click', () => {
    if (sprint4Typing) {
      clearTimeout(sprint4TypingTimeout);
      sprint4DialogueBox.innerHTML = sprint4Dialogues[sprint4Idx].text.replace(/\n/g, "<br>");
      sprint4Typing = false;
      return;
    }
    sprint4Idx++;
    if (sprint4Idx < sprint4Dialogues.length) {
      showSprint4Dialogue(sprint4Idx);
    }
  });

  sprint4CloseBtn.addEventListener('click', () => {
    sprint4Page.style.display = "none";
    document.getElementById('carousel-container').style.display = "flex";
    carouselEvent.focus();
  });

  // Make sure this code is present and correct:
document.getElementById('btn-trello').onclick = function() {
  window.open('images/projects/trello.jpg', '_blank');
};

  // Reunió dialogue data
const reunioDialogues = [
  {
    name: "Ferran",
    text: "Durant el tercer sprint vam tenir algunes dificultats organitzatives..."
  },
  {
    name: "Ferran",
    text: "Ens vam adonar que no estàvem comunicant-nos prou bé, i algunes tasques s’estaven solapant o quedant penjades."
  },
  {
    name: "Toni",
    text: "Vau tenir una reunió amb mi i vam tornar a encaminar el vostre producte."
  },
  {
    name: "Ferran",
    text: "La reunió amb tu ens va ajudar a realinear-nos, repartir millor les responsabilitats i millorar la comunicació."
  }
];
let reunioIdx = 0;
const reunioPage = document.getElementById('reunio-page');
const reunioDialogueBox = document.getElementById('reunio-dialogue-text');
const reunioNameBox = document.getElementById('reunio-character-name');
const reunioNextBtn = document.getElementById('reunio-next-btn');
const reunioCloseBtn = document.getElementById('reunio-close');
const reunioAvatar = document.getElementById('reunio-avatar');

let reunioTyping = false;
let reunioTypingTimeout;

function playTypeSound() {
  // Rewind and play for each letter
  typeSound.currentTime = 0;
  typeSound.play();
}

function typeReunioDialogue(text, callback, targetBox) {
  const box = targetBox || reunioDialogueBox;
  reunioTyping = true;
  box.innerHTML = "";
  let i = 0;
  function typeChar() {
    if (i < text.length) {
      box.innerHTML += text[i] === "\n" ? "<br>" : text[i];
      if (text[i] !== " " && text[i] !== "\n") playTypeSound();
      i++;
      reunioTypingTimeout = setTimeout(typeChar, 22);
    } else {
      reunioTyping = false;
      if (callback) callback();
    }
  }
  typeChar();
}

const reunioAvatars = {
  "Ferran": "images/characters/avatar_ferran.jpeg",
  "Toni": "images/characters/avatar_toni.png"
};

function showReunioDialogue(index) {
  const toniBox = document.getElementById('reunio-toni-box');
  const toniName = document.getElementById('reunio-toni-character-name');
  const toniText = document.getElementById('reunio-toni-dialogue-text');
  const toniNextBtn = document.getElementById('reunio-toni-next-btn');
  const ferranBox = document.getElementById('reunio-ferran-box');
  const ferranName = document.getElementById('reunio-character-name');
  const ferranText = document.getElementById('reunio-dialogue-text');
  const ferranNextBtn = document.getElementById('reunio-next-btn');
  const reunioCloseBtn = document.getElementById('reunio-close');

  const dialogue = reunioDialogues[index];

  if (dialogue.name === "Toni") {
    toniBox.style.display = "flex";
    toniName.textContent = dialogue.name;
    toniText.innerHTML = "";
    typeReunioDialogue(dialogue.text, null, toniText);
    ferranBox.style.display = "none";
    toniNextBtn.style.display = (index < reunioDialogues.length - 1) ? "inline-block" : "none";
    ferranNextBtn.style.display = "none";
  } else {
    toniBox.style.display = "none";
    ferranBox.style.display = "flex";
    ferranName.textContent = dialogue.name;
    typeReunioDialogue(dialogue.text, null, ferranText);
    toniNextBtn.style.display = "none";
    ferranNextBtn.style.display = (index < reunioDialogues.length - 1) ? "inline-block" : "none";
  }
  reunioCloseBtn.style.display = (index === reunioDialogues.length - 1) ? "inline-block" : "none";
}

carouselEvent.addEventListener('click', () => {
  if (events[eventIdx].title === "Reunió") {
    reunioPage.style.display = "flex";
    reunioPage.style.flexDirection = "column";
    reunioPage.style.alignItems = "center";
    reunioPage.style.justifyContent = "center";
    document.getElementById('carousel-container').style.display = "none";
    reunioIdx = 0;
    showReunioDialogue(reunioIdx);
  }
});

reunioNextBtn.addEventListener('click', () => {
  if (reunioTyping) {
    clearTimeout(reunioTypingTimeout);
    reunioDialogueBox.innerHTML = reunioDialogues[reunioIdx].text.replace(/\n/g, "<br>");
    reunioTyping = false;
    return;
  }
  reunioIdx++;
  if (reunioIdx < reunioDialogues.length) {
    showReunioDialogue(reunioIdx);
  }
});

document.getElementById('reunio-toni-next-btn').addEventListener('click', () => {
  if (reunioTyping) {
    clearTimeout(reunioTypingTimeout);
    document.getElementById('reunio-toni-dialogue-text').innerHTML = reunioDialogues[reunioIdx].text.replace(/\n/g, "<br>");
    reunioTyping = false;
    return;
  }
  reunioIdx++;
  if (reunioIdx < reunioDialogues.length) {
    showReunioDialogue(reunioIdx);
  }
});

reunioCloseBtn.addEventListener('click', () => {
  reunioPage.style.display = "none";
  document.getElementById('carousel-container').style.display = "flex";
  carouselEvent.focus();
});


// Demo dialogue data
const demoDialogues = [
  {
    name: "Davi",
    text: "Ha arribat el moment més esperat: la demostració de Hyperfit!"
  },
  {
    name: "Davi",
    text: "A continuació podreu veure com funciona l’aplicació que hem desenvolupat durant les últimes setmanes."
  },
  {
    name: "Davi",
    text: "Gràcies per acompanyar-nos en aquest viatge. Esperem que us agradi!"
  }
];
let demoIdx = 0;
const demoPage = document.getElementById('demo-page');
const demoDialogueBox = document.getElementById('demo-dialogue-text');
const demoNameBox = document.getElementById('demo-character-name');
const demoNextBtn = document.getElementById('demo-next-btn');
const demoCloseBtn = document.getElementById('demo-close');
const demoAvatar = document.getElementById('demo-avatar');

let demoTyping = false;
let demoTypingTimeout;

function typeDemoDialogue(text, callback) {
  demoTyping = true;
  demoDialogueBox.innerHTML = "";
  let i = 0;
  function typeChar() {
    if (i < text.length) {
      demoDialogueBox.innerHTML += text[i] === "\n" ? "<br>" : text[i];
      if (text[i] !== " " && text[i] !== "\n") playTypeSound();
      i++;
      demoTypingTimeout = setTimeout(typeChar, 22);
    } else {
      demoTyping = false;
      if (callback) callback();
    }
  }
  typeChar();
}

function showDemoDialogue(index) {
  demoNameBox.textContent = demoDialogues[index].name;
  typeDemoDialogue(demoDialogues[index].text);
  // Mostra el botó "Següent" només si no és l'últim diàleg
  demoNextBtn.style.display = (index < demoDialogues.length - 1) ? "inline-block" : "none";
  demoNextBtn.textContent = "Següent";
  // Amaga el botó "Tornar"
  demoCloseBtn.style.display = "none";
}

carouselEvent.addEventListener('click', () => {
  if (events[eventIdx].title === "Demo") {
    demoPage.style.display = "flex";
    demoPage.style.flexDirection = "column";
    demoPage.style.alignItems = "center";
    demoPage.style.justifyContent = "center";
    document.getElementById('carousel-container').style.display = "none";
    demoIdx = 0;
    showDemoDialogue(demoIdx);
  }
});

demoNextBtn.addEventListener('click', () => {
  if (demoTyping) {
    clearTimeout(demoTypingTimeout);
    demoDialogueBox.innerHTML = demoDialogues[demoIdx].text.replace(/\n/g, "<br>");
    demoTyping = false;
    return;
  }
  demoIdx++;
  if (demoIdx < demoDialogues.length) {
    showDemoDialogue(demoIdx);
  }
});

demoCloseBtn.addEventListener('click', () => {
  demoPage.style.display = "none";
  document.getElementById('carousel-container').style.display = "flex";
  carouselEvent.focus();
});

// Function to go back to carousel from any page
function goToCarousel() {
  // Hide all sprint/reunió/demo pages
  document.querySelectorAll('.sprint-page').forEach(page => page.style.display = "none");
  document.getElementById('carousel-container').style.display = "flex";
  document.getElementById('carousel-event').focus();
}

// Criteris d'acceptació button
document.getElementById('btn-criteris-acceptacio').onclick = function() {
  window.open('documents/criteris_acceptacio.pdf', '_blank');
};

// Figma button
document.getElementById('btn-figma').onclick = function() {
  window.open('https://www.figma.com/proto/ibH8mfDIIyRyINgMWlI64H/ENBIDIA-figma?node-id=4-145&starting-point-node-id=4%3A145', '_blank');
};

</script>




  </script>

</body>
</html>